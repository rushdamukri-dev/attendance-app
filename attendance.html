<!doctype html>
<html>
<head>
  <title>Attendance</title>
</head>
<body>
  <h2>Mark Attendance</h2>

  <form id="form">
    <input id="roll" placeholder="Roll No" required><br><br>
    <input id="name" placeholder="Name" required><br><br>
    <button type="submit">Submit</button>
  </form>

<script>
const params = new URLSearchParams(window.location.search);
const data = params.get("data");

if (!data) {
  alert("Invalid access. Scan QR.");
  location.href = "teacher.html";
}

const payload = JSON.parse(decodeURIComponent(data));

if (Date.now() > payload.expiry) {
  alert("QR expired");
  location.href = "teacher.html";
}

document.getElementById("form").onsubmit = e => {
  e.preventDefault();

  const roll = roll.value.trim();
  const name = name.value.trim();

  let records = JSON.parse(localStorage.getItem("records")) || [];

  if (records.some(r => r.roll === roll)) {
    alert("Roll already marked");
    return;
  }

  records.push({
    roll,
    name,
    time: new Date().toLocaleString()
  });

  localStorage.setItem("records", JSON.stringify(records));
  alert("Attendance marked successfully");
  e.target.reset();
};
</script>
</body>
</html>
