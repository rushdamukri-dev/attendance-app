<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Generate Attendance QR</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>

<h2>Teacher: Generate Attendance QR</h2>
<button id="generate">New QR for This Class</button>
<div id="qrcode" style="margin-top:20px;"></div>

<script>
document.getElementById("generate").addEventListener("click", () => {
  const sessionId = Math.random().toString(36).substring(2, 8);
  const expiry = Date.now() + (10 * 60 * 1000); // 10 minutes

  localStorage.setItem("sessionId", sessionId);
  localStorage.setItem("expiry", expiry);
  localStorage.removeItem("marked");
  localStorage.removeItem("records");

  const payload = { session: sessionId, exp: expiry };
  const encoded = encodeURIComponent(JSON.stringify(payload));

 const url =
  "https://rushdamukri-dev.github.io/teacher.html/attendance.html?token=" +
  encoded;


  document.getElementById("qrcode").innerHTML = "";
 const box = document.getElementById("qrcode");
box.innerHTML = "";

QRCode.toCanvas(url, { width: 220 }, (_, canvas) => {
  box.appendChild(canvas);

  const p = document.createElement("p");
  p.style.wordBreak = "break-all";
  p.innerText = url;

  box.appendChild(p);
});

});
</script>

</body>
</html>
